import{T as z}from"./download-todo-vqAj9Tg4.js";import{_ as B,r as h,s as L,o as M,a as A,c as g,b as t,w as l,d as U,e as S,F as O,f as P,g as N,h as I,i as R,j as V,k as E,l as W,m as p,n as v,p as u,t as f,q as r,u as j,v as q}from"./index-9M1sJ_mE.js";const G={name:"download",components:{ToDownload:z},setup(){let d=h({showFtpTypePicker:!1,showLinkDiv:!1,showBtDiv:!1,showMetaLinkDiv:!1,downloads:[],timeout:null}),n=h({btContent:null,dir:L.state.options.dir,link:null,"max-connection-per-server":16,split:32,"ftp-type":null,"ftp-user":null,"ftp-passwd":null});const c=()=>{d.timeout&&clearTimeout(d.timeout),N().then(i=>{L.dispatch("filterStates",i.data);const a=i.data.filter(s=>s.id.indexOf("sendTellActiveREQ_")===0).map(s=>s.result);a&&a.length>0&&(d.downloads.length=0,d.downloads.push(...a[0])),d.timeout=setTimeout(c,1e3)})};c(),M(()=>{d.timeout&&clearTimeout(d.timeout)});const e=i=>{n["ftp-type"]=i,d.showFtpTypePicker=!1},C=()=>{if(n.btContent=void 0,n["mateContent "]=void 0,n["ftp-type"]===""&&(n["ftp-type"]=void 0),n["ftp-user"]===""&&(n["ftp-user"]=void 0),n["ftp-passwd"]===""&&(n["ftp-passwd"]=void 0),n.link&&n.link.trim().toUpperCase().indexOf("ED2K://")===0){I("暂不支持该协议的下载功能！！！");return}R(n.link,n).then(i=>{d.showLinkDiv=!1,V(`操作成功: ${i.data.result}`)})},D=()=>{n.link=void 0,n["mateContent "]=void 0,n["ftp-type"]=void 0,n["ftp-user"]=void 0,n["ftp-passwd"]=void 0,E(n.btContent,n).then(i=>{d.showBtDiv=!1,V(`操作成功: ${i.data.result}`)})},k=()=>{n.btContent=void 0,n.link=void 0,n["ftp-type"]=void 0,n["ftp-user"]=void 0,n["ftp-passwd"]=void 0,W(n.mateContent,n).then(i=>{d.showMetaLinkDiv=!1,V(`操作成功: ${i.data.result}`)})},_=i=>{let a=new FileReader;a.readAsDataURL(i.target.files[0]),a.onload=s=>{n.btContent=s.target.result.replace("data:application/octet-stream;base64,","").replace("data:application/x-bittorrent;base64,","")}},w=i=>{let a=new FileReader;a.readAsDataURL(i.target.files[0]),a.onload=s=>{n.mateContent=s.target.result.replace("data:application/octet-stream;base64,","").replace("data:application/x-bittorrent;base64,","")}};return{activeId:A("1"),linkTmp:n,onSaveLink:C,opts:d,onChooseFtpType:e,onSaveBt:D,changeBTCode:_,onSaveMetaLink:k,changeMetaLinkCode:w}}},m=d=>(j("data-v-ffa69745"),d=d(),q(),d),K={class:"download-area"},Q=m(()=>r("i",{class:"fa fa-link"},null,-1)),H=m(()=>r("i",{class:"fa fa-file-download"},null,-1)),J=m(()=>r("i",{class:"fa fa-bezier-curve"},null,-1)),X={key:1},Y=m(()=>r("i",{class:"fa fa-magnet"},null,-1)),Z=m(()=>r("i",{class:"fa fa-broom"},null,-1)),$=m(()=>r("i",{class:"fa fa-home"},null,-1)),nn=m(()=>r("i",{class:"fa fa-cog"},null,-1)),en={style:{margin:"16px"}},tn=m(()=>r("i",{class:"fa fa-home"},null,-1)),on=m(()=>r("i",{class:"fa fa-cog"},null,-1)),ln={style:{margin:"16px"}},an=m(()=>r("i",{class:"fa fa-home"},null,-1)),dn=m(()=>r("i",{class:"fa fa-cog"},null,-1)),sn={style:{margin:"16px"}};function rn(d,n,c,e,C,D){const k=p("van-grid-item"),_=p("van-grid"),w=p("van-empty"),x=p("ToDownload"),i=p("van-button"),a=p("van-field"),s=p("van-slider"),y=p("van-cell-group"),b=p("van-form"),T=p("van-popup"),F=p("van-picker");return v(),g("div",K,[t(_,{"column-num":3},{default:l(()=>[t(k,{text:"URL",onClick:n[0]||(n[0]=o=>e.opts.showLinkDiv=!0)},{icon:l(()=>[Q]),_:1}),t(k,{text:"Torrent",onClick:n[1]||(n[1]=o=>e.opts.showBtDiv=!0)},{icon:l(()=>[H]),_:1}),t(k,{text:"MetaLink",onClick:n[2]||(n[2]=o=>e.opts.showMetaLinkDiv=!0)},{icon:l(()=>[J]),_:1})]),_:1}),e.opts.downloads.length===0?(v(),U(w,{key:0,description:"尚无任务"})):S("",!0),e.opts.downloads.length>0?(v(),g("div",X,[(v(!0),g(O,null,P(e.opts.downloads,o=>(v(),U(x,{key:o.id,todo:o},null,8,["todo"]))),128))])):S("",!0),t(T,{show:e.opts.showLinkDiv,"onUpdate:show":n[16]||(n[16]=o=>e.opts.showLinkDiv=o),position:"top"},{default:l(()=>[t(b,{onSubmit:e.onSaveLink},{default:l(()=>[t(y,{inset:""},{default:l(()=>[t(a,{label:"链接",value:"","input-align":"right",clearable:""},{input:l(()=>[t(i,{type:"primary",size:"mini",round:"",color:"purple",onClick:n[3]||(n[3]=o=>e.linkTmp.link="magnet:?xt=urn:btih:xxx")},{default:l(()=>[Y]),_:1}),t(i,{type:"default",size:"mini",round:"",onClick:n[4]||(n[4]=o=>e.linkTmp.link="")},{default:l(()=>[Z]),_:1})]),_:1}),t(a,{modelValue:e.linkTmp.link,"onUpdate:modelValue":n[5]||(n[5]=o=>e.linkTmp.link=o),placeholder:"请输入",clickable:"",onClear:n[6]||(n[6]=o=>e.linkTmp.link=""),type:"textarea",rows:"3"},null,8,["modelValue"]),t(a,{modelValue:e.linkTmp.dir,"onUpdate:modelValue":n[7]||(n[7]=o=>e.linkTmp.dir=o),label:"下载路径",placeholder:"请输入"},null,8,["modelValue"]),t(a,{"input-align":"center"},{input:l(()=>[t(i,{type:"success",size:"mini",round:"",plain:"",onClick:n[8]||(n[8]=o=>e.linkTmp.dir="C:/Users/Administrator/Desktop")},{default:l(()=>[$]),_:1}),t(i,{type:"success",size:"mini",round:"",plain:"",onClick:n[9]||(n[9]=o=>e.linkTmp.dir="D:/TDDOWNLOAD")},{default:l(()=>[nn]),_:1})]),_:1}),t(a,{label:"最大连接数"},{input:l(()=>[t(s,{modelValue:e.linkTmp["max-connection-per-server"],"onUpdate:modelValue":n[10]||(n[10]=o=>e.linkTmp["max-connection-per-server"]=o),max:"16"},{button:l(()=>[t(i,{type:"primary",size:"mini",round:""},{default:l(()=>[u(f(e.linkTmp["max-connection-per-server"]),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(a,{label:"最大线程数"},{input:l(()=>[t(s,{modelValue:e.linkTmp.split,"onUpdate:modelValue":n[11]||(n[11]=o=>e.linkTmp.split=o),max:"100"},{button:l(()=>[t(i,{type:"primary",size:"mini",round:""},{default:l(()=>[u(f(e.linkTmp.split),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(a,{modelValue:e.linkTmp["ftp-type"],"onUpdate:modelValue":n[12]||(n[12]=o=>e.linkTmp["ftp-type"]=o),readonly:"",clickable:"",name:"picker",label:"FTP类型",placeholder:"点击选择",onClick:n[13]||(n[13]=o=>e.opts.showFtpTypePicker=!0)},null,8,["modelValue"]),t(a,{modelValue:e.linkTmp["ftp-user"],"onUpdate:modelValue":n[14]||(n[14]=o=>e.linkTmp["ftp-user"]=o),label:"FTP用户",placeholder:"请输入"},null,8,["modelValue"]),t(a,{modelValue:e.linkTmp["ftp-passwd"],"onUpdate:modelValue":n[15]||(n[15]=o=>e.linkTmp["ftp-passwd"]=o),label:"FTP密码",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),r("div",en,[t(i,{round:"",block:"",type:"primary","native-type":"submit"},{default:l(()=>[u(" 提交 ")]),_:1})])]),_:1},8,["onSubmit"])]),_:1},8,["show"]),t(T,{show:e.opts.showBtDiv,"onUpdate:show":n[22]||(n[22]=o=>e.opts.showBtDiv=o),position:"top"},{default:l(()=>[t(b,{onSubmit:e.onSaveBt},{default:l(()=>[t(y,{inset:""},{default:l(()=>[t(a,{label:"种子","input-align":"right",type:"file",onChange:e.changeBTCode},null,8,["onChange"]),t(a,{modelValue:e.linkTmp.dir,"onUpdate:modelValue":n[17]||(n[17]=o=>e.linkTmp.dir=o),label:"下载路径",placeholder:"请输入"},null,8,["modelValue"]),t(a,{"input-align":"center"},{input:l(()=>[t(i,{type:"success",size:"mini",round:"",plain:"",onClick:n[18]||(n[18]=o=>e.linkTmp.dir="C:/Users/Administrator/Desktop")},{default:l(()=>[tn]),_:1}),t(i,{type:"success",size:"mini",round:"",plain:"",onClick:n[19]||(n[19]=o=>e.linkTmp.dir="D:/TDDOWNLOAD")},{default:l(()=>[on]),_:1})]),_:1}),t(a,{label:"最大连接数"},{input:l(()=>[t(s,{modelValue:e.linkTmp["max-connection-per-server"],"onUpdate:modelValue":n[20]||(n[20]=o=>e.linkTmp["max-connection-per-server"]=o),max:"16"},{button:l(()=>[t(i,{type:"primary",size:"mini",round:""},{default:l(()=>[u(f(e.linkTmp["max-connection-per-server"]),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(a,{label:"最大线程数"},{input:l(()=>[t(s,{modelValue:e.linkTmp.split,"onUpdate:modelValue":n[21]||(n[21]=o=>e.linkTmp.split=o),max:"100"},{button:l(()=>[t(i,{type:"primary",size:"mini",round:""},{default:l(()=>[u(f(e.linkTmp.split),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),r("div",ln,[t(i,{round:"",block:"",type:"primary","native-type":"submit"},{default:l(()=>[u(" 提交 ")]),_:1})])]),_:1},8,["onSubmit"])]),_:1},8,["show"]),t(T,{show:e.opts.showMetaLinkDiv,"onUpdate:show":n[28]||(n[28]=o=>e.opts.showMetaLinkDiv=o),position:"top"},{default:l(()=>[t(b,{onSubmit:e.onSaveMetaLink},{default:l(()=>[t(y,{inset:""},{default:l(()=>[t(a,{label:"MetaLink","input-align":"right",type:"file",onChange:e.changeMetaLinkCode},null,8,["onChange"]),t(a,{modelValue:e.linkTmp.dir,"onUpdate:modelValue":n[23]||(n[23]=o=>e.linkTmp.dir=o),label:"下载路径",placeholder:"请输入"},null,8,["modelValue"]),t(a,{"input-align":"center"},{input:l(()=>[t(i,{type:"success",size:"mini",round:"",plain:"",onClick:n[24]||(n[24]=o=>e.linkTmp.dir="C:/Users/Administrator/Desktop")},{default:l(()=>[an]),_:1}),t(i,{type:"success",size:"mini",round:"",plain:"",onClick:n[25]||(n[25]=o=>e.linkTmp.dir="D:/TDDOWNLOAD")},{default:l(()=>[dn]),_:1})]),_:1}),t(a,{label:"最大连接数"},{input:l(()=>[t(s,{modelValue:e.linkTmp["max-connection-per-server"],"onUpdate:modelValue":n[26]||(n[26]=o=>e.linkTmp["max-connection-per-server"]=o),max:"16"},{button:l(()=>[t(i,{type:"primary",size:"mini",round:""},{default:l(()=>[u(f(e.linkTmp["max-connection-per-server"]),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(a,{label:"最大线程数"},{input:l(()=>[t(s,{modelValue:e.linkTmp.split,"onUpdate:modelValue":n[27]||(n[27]=o=>e.linkTmp.split=o),max:"100"},{button:l(()=>[t(i,{type:"primary",size:"mini",round:""},{default:l(()=>[u(f(e.linkTmp.split),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),r("div",sn,[t(i,{round:"",block:"",type:"primary","native-type":"submit"},{default:l(()=>[u(" 提交 ")]),_:1})])]),_:1},8,["onSubmit"])]),_:1},8,["show"]),t(T,{show:e.opts.showFtpTypePicker,"onUpdate:show":n[30]||(n[30]=o=>e.opts.showFtpTypePicker=o),position:"bottom"},{default:l(()=>[t(F,{columns:["binary","ascii"],onConfirm:e.onChooseFtpType,onCancel:n[29]||(n[29]=o=>d.opt.showFtpTypePicker=!1)},null,8,["onConfirm"])]),_:1},8,["show"])])}const un=B(G,[["render",rn],["__scopeId","data-v-ffa69745"]]);export{un as default};
